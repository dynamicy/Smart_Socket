/*
 * HTML5 Video Player with RightSide Playlist v2.1
 *
 * Copyright 2012, LambertGroup
 * 
*/

(function(d){d.fn.vp2_html5_rightSidePlaylist_Video=function(a){var g,S,T,t=!1,w,x,U,V,W,X,Y,Z,$,aa,ba,L,ca,G=!1,u,q,H,a=d.extend({skin:"universalBlack",initialVolume:1,showInfo:!0,autoPlayFirstMovie:!1,autoPlay:!0,loop:!0,seekBarAdjust:255,borderWidth:15,borderColor:"#e9e9e9",playlistWidth:300,playlistCharactersLimit:100,numberOfThumbsPerScreen:4},a);return this.each(function(){function I(){if(document.getElementById(g).readyState){q=document.getElementById(g).duration;l.slider({value:0,step:0.01, orientation:"horizontal",range:"min",max:q,animate:!0,slide:function(){M=!0},stop:function(a,r){M=!1;document.getElementById(g).currentTime=r.value}});var a=0;p.progressbar({value:a});b.bind("progress",function(){a=document.getElementById(g).buffered.end(document.getElementById(g).buffered.length-1);0<a&&p.progressbar({value:a*p.css("width").substring(0,p.css("width").length-2)/q})});k.show()}else setTimeout(I,200)}var b=d(this);g=b.attr("id");var k=d('<div class="VideoControls"><a class="VideoRewind" title="Rewind"></a><a class="VideoPlay" title="Play/Pause"></a><div class="VideoBuffer"></div><div class="VideoSeek"></div><a class="VideoShowHidePlaylist" title="Show/Hide Playlist"></a><a class="VideoInfoBut" title="Info"></a><div class="VideoTimer">00:00</div><div class="VolumeAll"><div class="VolumeSlider"></div><a class="VolumeButton" title="Mute/Unmute"></a></div><a class="VideoFullScreen" title="FullScreen"></a></div> <div class="VideoInfoBox"></div> <div class="thumbsHolderWrapper"><div class="thumbsHolderVisibleWrapper"><div class="thumbsHolder"></div></div></div> <div class="slider-vertical"></div> </div>'), c=b.parent(".vp2_html5_rightSidePlaylist"),m=c.parent(".vp2_html5_rightSidePlaylistBorder");c.addClass(a.skin);c.append(k);var k=d(".VideoControls",c),j=d(".VideoInfoBox",c),y=d(".VideoRewind",c),v=d(".VideoPlay",c),p=d(".VideoBuffer",c),l=d(".VideoSeek",c),da=d(".VideoInfoBut",c);a.showInfo||da.addClass("hideElement");var N=d(".VideoShowHidePlaylist",c),z=d(".VideoTimer",c),ea=d(".VolumeAll",c),O=d(".VolumeSlider",c),D=d(".VolumeButton",c),E=d(".VideoFullScreen",c);k.width(b.width());m.width(b.width()+ 3*a.borderWidth+a.playlistWidth);m.height(b.height()+2*a.borderWidth);m.css("background",a.borderColor);c.css("top",a.borderWidth+"px");c.css("left",a.borderWidth+"px");l.css("width",b[0].offsetWidth-a.seekBarAdjust+"px");p.css("width",l.css("width"));j.css("width",b[0].offsetWidth-40+"px");k.hide();w=b[0].offsetWidth;x=b[0].offsetHeight;X=m.css("position");Y=m.css("z-index");S=d("body").css("margin");T=d("body").css("overflow");var A=!1,f=d(".thumbsHolderWrapper",c),F=d(".thumbsHolderVisibleWrapper", c),s=d(".thumbsHolder",c),i=d(".slider-vertical",c);F.width(a.playlistWidth);F.height(c.height());f.width(a.playlistWidth);f.height(c.height());f.css("top",0);f.css("left",+b[0].offsetWidth+a.borderWidth+"px");s.width(a.playlistWidth);s.css("top",a.borderWidth+"px");var B=0,n=0,e=0,h=[];d(".xplaylist",c).children().each(function(){currentElement=d(this);e++;h[e-1]=[];h[e-1].title="";h[e-1].desc="";h[e-1].thumb="";h[e-1].preview="";h[e-1].xsources_mp4="";h[e-1].xsources_ogv="";h[e-1].xsources_webm= "";h[e-1].xsources_mp4v="";null!=currentElement.find(".xtitle").html()&&(h[e-1].title=currentElement.find(".xtitle").html());null!=currentElement.find(".xdesc").html()&&(h[e-1].desc=currentElement.find(".xdesc").html());null!=currentElement.find(".xthumb").html()&&(h[e-1].thumb=currentElement.find(".xthumb").html());null!=currentElement.find(".xpreview").html()&&(h[e-1].preview=currentElement.find(".xpreview").html());null!=currentElement.find(".xsources_mp4").html()&&(h[e-1].sources_mp4=currentElement.find(".xsources_mp4").html()); null!=currentElement.find(".xsources_ogv").html()&&(h[e-1].sources_ogv=currentElement.find(".xsources_ogv").html());null!=currentElement.find(".xsources_webm").html()&&(h[e-1].sources_webm=currentElement.find(".xsources_webm").html());null!=currentElement.find(".xsources_mp4v").html()&&(h[e-1].sources_mp4v=currentElement.find(".xsources_mp4v").html());desc_aux=String(h[e-1].desc);desc_aux.length>a.playlistCharactersLimit&&(desc_aux=desc_aux.substr(0,desc_aux.indexOf(" ",a.playlistCharactersLimit))+ "...");thumbsHolder_Thumb=d('<div class="thumbsHolder_ThumbOFF" rel="'+(e-1)+'"><div class="padding"><img src="'+h[e-1].thumb+'"><span class="title">'+h[e-1].title+'</span><br><span class="reg">'+desc_aux+"</span></div></div>");s.append(thumbsHolder_Thumb);1===e&&thumbsHolder_Thumb.addClass("thumbsHolder_ThumbON");B=Math.floor((f.height()-thumbsHolder_Thumb.height()*a.numberOfThumbsPerScreen)/(a.numberOfThumbsPerScreen-1));s.css("height",s.height()+B+thumbsHolder_Thumb.height()+"px");1>=e?thumbsHolder_Thumb.css("margin-top", Math.floor((f.height()-2*a.borderWidth-(B+thumbsHolder_Thumb.height())*(a.numberOfThumbsPerScreen-1)-thumbsHolder_Thumb.height())/2)+"px"):thumbsHolder_Thumb.css("margin-top",B+"px");thumbsHolder_MarginTop=parseInt((f.height()-parseInt(thumbsHolder_Thumb.css("height").substring(0,thumbsHolder_Thumb.css("height").length-2)))/2)});e>a.numberOfThumbsPerScreen&&(i.slider({orientation:"vertical",range:"min",min:1,max:100,step:1,value:100,slide:function(a,b){J(b.value)}}),i.css("display","inline"),i.css("position", "absolute"),i.height(f.height()-25),i.css("left",Math.floor(b[0].offsetWidth+a.borderWidth+a.playlistWidth+(a.borderWidth-i.width())/2)+"px"),i.css("top","0px"));var J=function(r){var b=(thumbsHolder_Thumb.height()+B)*(e-a.numberOfThumbsPerScreen);s.stop(!0,!0);r&&!A?(A=!0,s.animate({top:parseInt(a.borderWidth+b*(r-100)/100)+"px"},1100,"easeOutQuad",function(){A=!1})):!A&&e>a.numberOfThumbsPerScreen&&(A=!0,s.css("opacity","0.5"),r=parseInt(a.borderWidth-(thumbsHolder_Thumb.height()+B)*n,10),Math.abs(r)> b&&(r=a.borderWidth-b),i.slider("value",100+parseInt(100*r/b)),s.animate({opacity:1,top:r+"px"},500,"easeOutCubic",function(){A=!1}))};F.mousewheel(function(a,b){a.preventDefault();var d=i.slider("value");if(1<parseInt(d)&&-1==parseInt(b)||100>parseInt(d)&&1==parseInt(b))d+=b,i.slider("value",d),J(d)});var C=d(".thumbsHolder_ThumbOFF",c);C.click(function(){var b=d(this).attr("rel");d(C[n]).removeClass("thumbsHolder_ThumbON");n=b;P(a.autoPlay)});C.mouseenter(function(){var a=d(this);a.attr("rel"); a.addClass("thumbsHolder_ThumbON")});C.mouseleave(function(){var a=d(this),b=a.attr("rel");n!=b&&a.removeClass("thumbsHolder_ThumbON")});var P=function(a){l.slider("destroy");p.progressbar("destroy");b.unbind("progress");H="Infinity";document.getElementById(g).poster=h[n].preview;j.html('<p class="movieTitle">'+h[n].title+'</p><p class="movieDesc">'+h[n].desc+"</p>");var c=document.getElementById(g);d(C[n]).addClass("thumbsHolder_ThumbON");J();var e=h[n].sources_webm,f=navigator.userAgent.toLowerCase(); if(-1!=f.indexOf("opera")||-1!=f.indexOf("firefox")||-1!=f.indexOf("mozzila"))e=h[n].sources_ogv;if(-1!=f.indexOf("chrome")||-1!=f.indexOf("msie")||-1!=f.indexOf("safari"))e=h[n].sources_mp4;if(-1!=f.indexOf("android")||-1!=f.indexOf("opera"))e=h[n].sources_webm;if(-1!=f.indexOf("ipad")||-1!=f.indexOf("iphone")||-1!=f.indexOf("ipod")||-1!=f.indexOf("webos"))e=h[n].sources_mp4;c.src=e;document.getElementById(g).load();c=navigator.userAgent.toLowerCase();-1!=c.indexOf("ipad")||-1!=c.indexOf("iphone")|| -1!=c.indexOf("ipod")||-1!=c.indexOf("webos")||-1!=c.indexOf("android")?(a?(document.getElementById(g).play(),v.addClass("VideoPause")):v.removeClass("VideoPause"),I()):(clearInterval(H),H=setInterval(function(){0<document.getElementById(g).readyState&&(!isNaN(document.getElementById(g).duration)&&"Infinity"!=document.getElementById(g).duration)&&(q=document.getElementById(g).duration,I(),a?(document.getElementById(g).play(),v.addClass("VideoPause")):v.removeClass("VideoPause"),clearInterval(H))}, 700))};P(a.autoPlayFirstMovie);y.click(function(){document.getElementById(g).currentTime=0;document.getElementById(g).play()});var Q=function(){!1==document.getElementById(g).paused?document.getElementById(g).pause():document.getElementById(g).play()};v.click(Q);b.click(Q);b.bind("play",function(){v.addClass("VideoPause")});b.bind("pause",function(){v.removeClass("VideoPause")});y=navigator.userAgent.toLowerCase();-1!=y.indexOf("ipad")||(-1!=y.indexOf("iphone")||-1!=y.indexOf("ipod")||-1!=y.indexOf("webos"))|| (c.mouseover(function(){k.show()}),c.mouseout(function(){120>ea.css("height").substring(0,ea.css("height").length-2)&&k.hide()}));c.keydown(function(a){32==a.keyCode&&Q()});var fa=function(){t=!1;E.removeClass("VideoFullScreenIn");E.addClass("VideoFullScreen");d(".vp2_html5_rightSidePlaylist").css("display","block");d("body").css("margin",S);d("body").css("overflow",T);b.css("position",U);"none"!=f.css("display")?b.css("width",w+"px"):b.css("width",w+a.borderWidth+a.playlistWidth+"px");b.css("height", x+"px");b.css("top",W);b.css("left",V);m.css("position",X);m.css("width",w+3*a.borderWidth+a.playlistWidth+"px");m.css("height",x+2*a.borderWidth+"px");m.css("z-index",Y);m.css("background",a.borderColor);c.css("position",Z);c.css("top",aa);c.css("left",$);k.css("position",ba);k.css("bottom",L);k.width(b.width());l.css("width",b[0].offsetWidth-a.seekBarAdjust+"px");p.css("width",l.css("width"));j.css("width",c.width()-40+"px");j.css("position",ca);f.css("left",+w+a.borderWidth+"px");f.height(x);F.height(x); i.height(x-25);i.css("left",Math.floor(w+a.borderWidth+a.playlistWidth+(a.borderWidth-i.width())/2)+"px")};document.onkeydown=function(a){a=a||window.event;27==a.keyCode&&t&&fa()};E.click(function(){if(t)fa();else{t=!0;E.removeClass("VideoFullScreen");E.addClass("VideoFullScreenIn");U=b.css("position");V=b.css("left");W=b.css("top");Z=c.css("position");$=c.css("left");aa=c.css("top");ba=k.css("position");L=k.css("bottom");ca=j.css("position");d("body").css("overflow","hidden");d(".vp2_html5_rightSidePlaylist").css("display", "none");c.css("display","block");d("body").css("margin",0);m.css("position","fixed");m.css("top",0);m.css("left",0);m.css("width",window.innerWidth+"px");m.css("height",window.innerWidth+"px");m.css("background","#000000");m.css("z-index","10000");c.css("position","absolute");c.css("top",0);c.css("left",0);b.css("position","fixed");"none"!=f.css("display")?(b.css("width",window.innerWidth-2*a.borderWidth-a.playlistWidth+"px"),j.css("width",window.innerWidth-2*a.borderWidth-a.playlistWidth-40+"px")): (b.css("width",window.innerWidth+"px"),j.css("width",window.innerWidth-40+"px"));b.css("height",window.innerHeight+"px");b.css("top",0);b.css("left",0);k.css("position","fixed");k.css("bottom",L);k.width(b.width());l.css("width",b.width()-a.seekBarAdjust+"px");p.css("width",l.css("width"));j.css("position","fixed");f.css("left",+b[0].offsetWidth+a.borderWidth+"px");f.height(window.innerHeight);F.height(window.innerHeight);i.height(f.height()-25);var e=(a.borderWidth-i.width())/2;0>e&&(e=a.borderWidth- i.width());i.css("left",Math.floor(b[0].offsetWidth+a.borderWidth+a.playlistWidth+e)+"px")}});var R=!1;z.mouseover(function(){R=!0;u=document.getElementById(g).currentTime;q=document.getElementById(g).duration;z.text("-"+K(q-u))});z.mouseout(function(){R=!1;u=document.getElementById(g).currentTime;q=document.getElementById(g).duration;z.text(K(u))});var M=!1;I();var K=function(a){var b=10>Math.floor(a/60)?"0"+Math.floor(a/60):Math.floor(a/60);return b+":"+(10>Math.floor(a-60*b)?"0"+Math.floor(a-60* b):Math.floor(a-60*b))};b.bind("timeupdate",function(){u=document.getElementById(g).currentTime;q=document.getElementById(g).duration;M||l.slider("value",u);R?z.text("-"+K(q-u)):z.text(K(u))});da.click(function(){"giant"==a.skin?"none"==j.css("display")?j.fadeIn():j.fadeOut():j.slideToggle(300)});N.click(function(){if(!G)if(G=!0,"none"!=f.css("display")){var c;c=b[0].offsetWidth+a.borderWidth+a.playlistWidth;t&&(c+=a.borderWidth);N.addClass("VideoShowHidePlaylist_onlyShow");t?(l.width(l.width()+2* a.borderWidth+a.playlistWidth),p.width(p.width()+2*a.borderWidth+a.playlistWidth),j.width(j.width()+2*a.borderWidth+a.playlistWidth)):(l.width(l.width()+a.borderWidth+a.playlistWidth),p.width(p.width()+a.borderWidth+a.playlistWidth),j.width(j.width()+a.borderWidth+a.playlistWidth));i.css("display","none");f.animate({opacity:0},300,function(){f.css("display","none")});k.css("opacity",0);k.animate({width:c,opacity:1},300,function(){});b.animate({width:c},300,function(){G=!1})}else c=b[0].offsetWidth- a.borderWidth-a.playlistWidth,t&&(c-=a.borderWidth),N.removeClass("VideoShowHidePlaylist_onlyShow"),t?(l.width(l.width()-2*a.borderWidth-a.playlistWidth),p.width(p.width()-2*a.borderWidth-a.playlistWidth),j.width(j.width()-2*a.borderWidth-a.playlistWidth)):(l.width(l.width()-a.borderWidth-a.playlistWidth),p.width(p.width()-a.borderWidth-a.playlistWidth),j.width(j.width()-a.borderWidth-a.playlistWidth)),f.css("display","block"),i.css("display","block"),f.animate({opacity:1},600,function(){G=!1;J()}), k.css("opacity",0),k.animate({width:c,opacity:1},300,function(){}),f.css("left",+c+a.borderWidth+"px"),i.css("left",Math.floor(c+a.borderWidth+a.playlistWidth+(a.borderWidth-i.width())/2)+"px"),b.animate({width:c},300,function(){})});b[0].addEventListener("ended",function(){a.loop&&(d(C[n]).removeClass("thumbsHolder_ThumbON"),n==e-1?n=0:n++,P(a.autoPlay))},!1);var ga=1;O.slider({value:a.initialVolume,orientation:"vertical",range:"min",max:1,step:0.05,animate:!0,slide:function(a,b){document.getElementById(g).muted= !1;ga=b.value;document.getElementById(g).volume=b.value}});document.getElementById(g).volume=a.initialVolume;D.click(function(){!0==document.getElementById(g).muted?(document.getElementById(g).muted=!1,O.slider("value",ga),D.removeClass("VolumeButtonMute"),D.addClass("VolumeButton")):(document.getElementById(g).muted=!0,O.slider("value","0"),D.removeClass("VolumeButton"),D.addClass("VolumeButtonMute"))});b.removeAttr("controls")})};d.fn.vp2_html5_rightSidePlaylist_Video.skins={}})(jQuery);