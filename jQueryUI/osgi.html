<html>
<head>
<title></title>
<link type="text/css" href="styles/prettyPhoto.css" rel="stylesheet" id="prettyphoto-css" media="all">
<link type="text/css" href="styles/osgi.style.css" rel="stylesheet">
<script type='text/javascript' src='scripts/jquery-1.8.3.min.js'></script>
<script type='text/javascript' src='scripts/jquery.prettyPhoto.js'></script>
<script type='text/javascript' src='scripts/jquery.fancygallery.min.js'></script>
<script type='text/javascript' src='scripts/osgi.imap.js'></script>
<script language="JavaScript">
<!--
function FP_preloadImgs() {//v1.0
 var d=document,a=arguments; if(!d.FP_imgs) d.FP_imgs=new Array();
 for(var i=0; i<a.length; i++) { d.FP_imgs[i]=new Image; d.FP_imgs[i].src=a[i]; }
}

function FP_swapImg() {//v1.0
 var doc=document,args=arguments,elm,n; doc.$imgSwaps=new Array(); for(n=2; n<args.length;
 n+=2) { elm=FP_getObjectByID(args[n]); if(elm) { doc.$imgSwaps[doc.$imgSwaps.length]=elm;
 elm.$src=elm.src; elm.src=args[n+1]; } }
}

function FP_getObjectByID(id,o) {//v1.0
 var c,el,els,f,m,n; if(!o)o=document; if(o.getElementById) el=o.getElementById(id);
 else if(o.layers) c=o.layers; else if(o.all) el=o.all[id]; if(el) return el;
 if(o.id==id || o.name==id) return o; if(o.childNodes) c=o.childNodes; if(c)
 for(n=0; n<c.length; n++) { el=FP_getObjectByID(id,c[n]); if(el) return el; }
 f=o.forms; if(f) for(n=0; n<f.length; n++) { els=f[n].elements;
 for(m=0; m<els.length; m++){ el=FP_getObjectByID(id,els[n]); if(el) return el; } }
 return null;
}
// -->
	function smart_home_req(val,obj_name){
		var msg = new Array();
		msg[0]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay1_ON";
		msg[1]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay1_OFF";
		msg[2]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay2_ON";
		msg[3]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay2_OFF";
		$.get("socket_client.php?msg="+msg[val], function(data){check_error(data,val,obj_name)});
	}
	
	function check_error(data,val,obj_name){
		//var obj_id='div_test';
		if(data=="Fail\n"){
			setTimeout(function(){smart_home_req(val,obj)},1000);
			//alert("Req Done");
		}
		else{
			var obj = document.getElementById(obj_name);
			obj.innerHTML = data;//Return Message
		}
	}
</script>
</head>
<body>
<div id="wrapper">
<img width="700" height="446" src="images/bg.png" alt="House"> 
   <script type='text/javascript'>
	// code for IE7+, Firefox, Chrome, Opera, Safari, code for IE6, IE5
	var xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new XMLHttpRequest('Microsoft.XMLHTTP');
	var xmlapp = window.XMLHttpRequest ? new XMLHttpRequest() : new XMLHttpRequest('Microsoft.XMLHTTP');	
	
    xmlhttp.open("GET", "http://fermat.twbbs.org/appliance.xml", false);
    xmlapp.open("GET", "http://fermat.twbbs.org/bundle.xml", false);
    
    xmlhttp.send();
    xmlapp.send();
        
    var xmlDoc = xmlhttp.responseXML;
    var appDoc = xmlapp.responseXML;
    
    var root = xmlDoc.getElementsByTagName("root");    				
    var bundle = appDoc.getElementsByTagName("bundle");
    
    var tagMap = { 'Current':'', 'Temperature':'', 'Humidity':'', 'Luminosity':'', 
    				'Status1':'', 'Status2':'', 'Type1':'', 'Type2':'','Price':'' ,
    				'PriceWarning':'', 'CurrentWarning':'', 'Relay1':'', 'Relay2':''};
    
    $.each(tagMap, function(key, val)
    {
    	var keyElement = root[0].getElementsByTagName(key)[0];
    	if(keyElement)
	    {	
	    	tagMap[key] = keyElement.childNodes[0].nodeValue;
	    	
	    	var lightStatus = 0;
	    	var fanStatus = 0;
	    	var lightRelay = 0;
	    	var fanRelay = 0;
	    	
	    	switch(tagMap['Type1'])
	    	{
		    case 2:
		    	// case: type1 => light
		    	lightStatus = tagMap['Status1'];
		    	lightRelay = tagMap['Relay1'];		
		    	break;
		    case 3:
	    		// case: type1 => fan	    	
		    	fanStatus = tagMap['Status1'];
		    	fanRelay = tagMap['Relay1'];					    			    			    	
			default:
				break;	
	    	}

	    	switch(tagMap['Type2'])
	    	{
		    case 2:
		    	// case: type2 => light
		    	lightStatus = tagMap['Status2'];
		    	lightRelay = tagMap['Relay2'];	
		    	break;
		    case 3:
	    		// case: type2 => fan	    	
	    		fanStatus = tagMap['Status2'];
	    		fanRelay = tagMap['Relay2'];					    			    			    	
			default:
				break;	
	    	}
	    	
	    	// Electrical Fan
	    	document.write("<div class=\"pin pin-down\" data-xpos=\"310\" data-ypos=\"125\">");
	    	document.write("<h2>Electrical Fan</h2>");
	    	document.write("<ul>");
	    	if(fanStatus == 0)
	    	{
			    document.write("<li><b>Status: </b>" + "<img src=\"images/offline.png\" width=\"20\" height=\"20\"></li>");			    				    
	    	}
	    	else
	    	{
		    	document.write("<li><b>Status: </b>" + "<img src=\"images/online.png\" width=\"20\" height=\"20\"></li>");			    	
	    	}
	    	document.write("<li><b>Relay: </b>" + fanRelay + "</li>");
	    	document.write("<br><li>");
	    	if(tagMap['Type1'] == 3)
	    	{	    	
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(0,\"div_test\")>Turn On</button>");
	            document.write("   ");
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(1,\"div_test\")>Turn Off</button>");
	    	}
	    	else if(tagMap['Type2'] == 3)
	    	{
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(2,\"div_test\")>Turn On</button>");	            
	            document.write("   ");
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(3,\"div_test\")>Turn Off</button>");	            
	    	}
	    	document.write("</li>");
			document.write("<br>");	    	
	    	document.write("<li><img src=\"images/pc1.jpeg\" width=\"210\"></li>");
	    	document.write("</ul>");
	    	document.write("</div>");
	    	
	    	// Light
	    	document.write("<div class=\"pin pin-down\" data-xpos=\"500\" data-ypos=\"250\">");
	    	document.write("<h2>Light</h2>");
	    	document.write("<ul>");	    	
	    	if(lightStatus == 0)
	    	{
		    	document.write("<li><b>Status: </b>" + "<img src=\"images/offline.png\" width=\"20\" height=\"20\"></li>");			    	
	    	}
	    	else
	    	{
		    	document.write("<li><b>Status: </b>" + "<img src=\"images/online.png\" width=\"20\" height=\"20\"></li>");			    			    	
	    	}	    		  	    	
	    	document.write("<li><b>Relay: </b>" + fanRelay + "</li>");
			document.write("<br>");	    	
	    	document.write("<li>");	    	
	    	if(tagMap['Type1'] == 2)
	    	{	    	
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(0,\"div_test\")>Turn On</button>");
	            document.write("   ");
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(1,\"div_test\")>Turn Off</button>");           
	    	}
	    	else if(tagMap['Type2'] == 2)
	    	{
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(2,\"div_test\")>Turn On</button>");	            
	            document.write("   ");
	            document.write("<button type=\"button\" style=\"height: 50px; width: 80px\" onclick=smart_home_req(3,\"div_test\")>Turn Off</button>");	  	            
	    	}
	    	document.write("</li>");
			document.write("<br>");	    	    		    	
	    	document.write("<li><img src=\"images/pc2.jpeg\" width=\"210\"></li>");	    	
	    	document.write("</ul>");
	    	document.write("</div>");   			    	    		    	
	    }
    });

    for (i = 0; i < bundle.length; i++) 
    {   	
	    	if(bundle[i].getElementsByTagName("name")[0].childNodes[0].nodeValue == "MMN_WidgetTVBundle.Service_WidgetTV_Interface")
	    	{
		    		document.write("<div class=\"pin pin-down\" data-xpos=\"31\" data-ypos=\"205\">");
	    		  	document.write("<h2>Widget TV</h2><ul><li><b>Status:</b>");
			    	if(bundle[i].getElementsByTagName("status")[0].childNodes[0].nodeValue == "On")
			    	{
			    		document.write("<img src=\"images/online.png\" width=\"20\" height=\"20\">");
			    	}
			    	else
			    	{
			    		document.write("<img src=\"images/offline.png\" width=\"20\" height=\"20\">");
			    	}			    	
			    	document.write("</li>");		    		
			    	document.write("<li><b>Type: </b>");
			    	document.write(bundle[i].getElementsByTagName("type")[0].childNodes[0].nodeValue);
			    	document.write("</li>");			    				    		  			    	  	
			    	document.write("<li><b>Service:</b></li>");
			    	document.write("<li>");
			    	document.write(bundle[i].getElementsByTagName("service1")[0].childNodes[0].nodeValue);
			    	document.write("</li></ul>");
			}
			else if(bundle[i].getElementsByTagName("name")[0].childNodes[0].nodeValue == "MMN_SmartSocketBundle.Service_SmartSocket_Interface")
			{
			    	document.write("<div class=\"pin pin-down\" data-xpos=\"150\" data-ypos=\"255\">");
			    	document.write("<h2>Smart Socket</h2><ul><li><b>Status:</b>");
			    	if(bundle[i].getElementsByTagName("status")[0].childNodes[0].nodeValue == "On")
			    	{
			    		document.write("<img src=\"images/online.png\" width=\"20\" height=\"20\">");
			    	}
			    	else
			    	{
			    		document.write("<img src=\"images/offline.png\" width=\"20\" height=\"20\">");
			    	}			    	
			    	document.write("</li>");	  	
			    	document.write("<li><b>Temperature: </b>" + tagMap['Temperature'] + "</li>");
			    	document.write("<li><b>Luminosity: </b>" + tagMap['Luminosity'] + "</li>");
			    	document.write("<li><b>Current: </b>" + tagMap['Current'] + "</li>");			    	
			    	document.write("<li><b>Type: </b>");
			    	document.write(bundle[i].getElementsByTagName("type")[0].childNodes[0].nodeValue);
			    	document.write("</li><li><b>Service:</b></li><li>");
			    	document.write(bundle[i].getElementsByTagName("service1")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service2")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service3")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service4")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service5")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service6")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service7")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service8")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service9")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service10")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service11")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service12")[0].childNodes[0].nodeValue);
			    	document.write("</li></ul>");
			}
			else if(bundle[i].getElementsByTagName("name")[0].childNodes[0].nodeValue == "MMN_SmartPhoneBundle.Service_SmartPhone_Interface")
	    	{
			    	document.write("<div class=\"pin pin-down\" data-xpos=\"250\" data-ypos=\"305\">");
			    	document.write("<h2>Mobile</h2><ul><li><b>Status:</b>");
			    	if(bundle[i].getElementsByTagName("status")[0].childNodes[0].nodeValue == "On")
			    	{
			    		document.write("<img src=\"images/online.png\" width=\"20\" height=\"20\">");
			    	}
			    	else
			    	{
			    		document.write("<img src=\"images/offline.png\" width=\"20\" height=\"20\">");
			    	}			    	
			    	document.write("</li><li><b>Type: </b>");
			    	document.write(bundle[i].getElementsByTagName("type")[0].childNodes[0].nodeValue);
			    	document.write("</li><li><b>Service: </b></li><li>");
			    	document.write(bundle[i].getElementsByTagName("service1")[0].childNodes[0].nodeValue);
			    	document.write("</li></ul>");
			}
			else if(bundle[i].getElementsByTagName("name")[0].childNodes[0].nodeValue == "MMN_MediaServerBundle.Service_MediaServer_Interface")			
			{
			    	document.write("<div class=\"pin pin-down\" data-xpos=\"50\" data-ypos=\"325\">");
			    	document.write("<h2>Media Server</h2><ul><li><b>Status:</b>");
			    	if(bundle[i].getElementsByTagName("status")[0].childNodes[0].nodeValue == "On")
			    	{
			    		document.write("<img src=\"images/online.png\" width=\"20\" height=\"20\">");
			    	}
			    	else
			    	{
			    		document.write("<img src=\"images/offline.png\" width=\"20\" height=\"20\">");
			    	}			    	
			    	document.write("</li><li><b>Type: </b>");
			    	document.write(bundle[i].getElementsByTagName("type")[0].childNodes[0].nodeValue);
			    	document.write("</li><li><b>Service: </b></li><li>");
			    	document.write(bundle[i].getElementsByTagName("service1")[0].childNodes[0].nodeValue);
			    	document.write("</li><li>");
			    	document.write(bundle[i].getElementsByTagName("service2")[0].childNodes[0].nodeValue);
			    	document.write("</li></ul>");
			}
    }
</script>
<div align="center" id="div_test"></div>
</body>
</html>